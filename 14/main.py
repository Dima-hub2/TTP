"""
Главный модуль программы - консольное приложение для управления заданиями.

Программа предоставляет интерактивное меню для выполнения трех заданий:
1. Задание 1 - обработка двух массивов
2. Задание 4 - арифметические операции над числами-массивами
3. Задание 5 - поиск подмассивов с заданной суммой

Структура
---------
- Глобальные переменные для хранения данных и результатов
- Функция menu() - отображение главного меню
- Функция input_arr() - ввод массива с возможностью ручного или случайного заполнения
- Функции task1(), task4(), task5() - логика выполнения соответствующих заданий
- Основной цикл программы
"""

import sys
import random
from task_1 import execute_task_1_algorithm
from task_4 import execute_task_4_algorithm
from task_5 import execute_task_5_algorithm

# Глобальные переменные для хранения данных
data1 = None  # Кортеж (arr1, arr2) для задания 1
data4 = None  # Кортеж (arr1, arr2, operation) для задания 4
data5 = None  # Кортеж (arr, target_sum) для задания 5
res1 = None   # Результат задания 1
res4 = None   # Результат задания 4
res5 = None   # Результат задания 5


def menu():
    """
    Отображает главное меню программы и получает выбор пользователя.

    Returns
    -------
    str
        Выбор пользователя в виде строки ('1', '4', '5' или '0').

    Notes
    -----
    Меню включает следующие пункты:
    1. Задание 1 - Обработка двух массивов
    4. Задание 4 - Арифметика чисел-массивов
    5. Задание 5 - Подмассивы с заданной суммой
    0. Выход
    """
    print("\n=== ГЛАВНОЕ МЕНЮ ===")
    print("1. Задание 1 - Обработка двух массивов")
    print("4. Задание 4 - Арифметика чисел-массивов")
    print("5. Задание 5 - Подмассивы с заданной суммой")
    print("0. Выход")
    return input("Выберите пункт меню: ")


def input_arr():
    """
    Вводит массив чисел с возможностью ручного или случайного заполнения.

    Returns
    -------
    list
        Массив целых чисел.

    Process
    -------
    1. Запрашивает размер массива n (целое число).
    2. Предлагает выбор способа заполнения:
       - "1" - ручной ввод через пробел
       - "2" - случайное заполнение в диапазоне [-10, 10]
    3. Возвращает список из n целых чисел.

    Raises
    ------
    ValueError
        Если введено некорректное число или выбор способа заполнения.

    Examples
    --------
    >>> arr = input_arr()
    Размер массива: 3
    1 - вручную, 2 - случайные числа: 2
    >>> print(arr)
    [5, -2, 9]
    """
    n = int(input("Размер массива: "))
    way = input("1 - вручную, 2 - случайные числа: ")
    
    if way == "2":
        return [random.randint(-10, 10) for _ in range(n)]
    else:
        return list(map(int, input("Введите числа через пробел: ").split()))


def task1():
    """
    Выполняет задание 1 через консольный интерфейс.

    Process
    -------
    1. Запрашивает два массива через функцию input_arr().
    2. Выполняет алгоритм задания 1 из модуля task_1.
    3. Сохраняет исходные данные и результат в глобальные переменные:
       - data1 = (a, b)
       - res1 = итоговый массив
    4. Выводит:
       - Отсортированный первый массив (по убыванию)
       - Отсортированный второй массив (по возрастанию)
       - Итоговый массив

    Global Variables
    ----------------
    data1 : tuple or None
        Кортеж (arr1, arr2) с исходными данными.
    res1 : list or None
        Результат выполнения алгоритма.

    See Also
    --------
    input_arr : функция ввода массива
    execute_task_1_algorithm : алгоритм выполнения задания 1
    """
    global data1, res1
    print("\n--- Задание 1: Обработка двух массивов ---")
    
    print("Введите первый массив:")
    a = input_arr()
    print("Введите второй массив:")
    b = input_arr()
    
    data1 = (a, b)
    # Используем копии массивов, чтобы не изменять оригиналы
    res1, s1, s2 = execute_task_1_algorithm(a.copy(), b.copy())
    
    print("\nРезультаты:")
    print(f"Отсортированный первый массив (по убыванию): {s1}")
    print(f"Отсортированный второй массив (по возрастанию): {s2}")
    print(f"Итоговый массив: {res1}")


def task4():
    """
    Выполняет задание 4 через консольный интерфейс.

    Process
    -------
    1. Запрашивает два числа в виде массивов цифр (ввод через пробел).
    2. Запрашивает операцию ('+' или '-').
    3. Выполняет арифметическую операцию через модуль task_4.
    4. Сохраняет данные и результат в глобальные переменные:
       - data4 = (a, b, op)
       - res4 = результат операции
    5. Выводит результат в читаемом формате (заменяет '-' на '−').

    Global Variables
    ----------------
    data4 : tuple or None
        Кортеж (arr1, arr2, operation) с исходными данными.
    res4 : list or None
        Результат выполнения алгоритма.

    Examples
    --------
    >>> task4()
    Введите первое число (цифры через пробел): 1 2 3
    Введите второе число (цифры через пробел): 4 5
    Операция (+ или -): -
    Результат: 78
    """
    global data4, res4
    print("\n--- Задание 4: Арифметика чисел-массивов ---")
    
    print("Введите первое число (цифры через пробел):")
    a = list(map(int, input().split()))
    
    print("Введите второе число (цифры через пробел):")
    b = list(map(int, input().split()))
    
    op = input("Операция (+ или -): ")
    
    data4 = (a, b, op)
    res4 = execute_task_4_algorithm(a, b, op)
    
    # Форматируем вывод: заменяем дефис на минус для читаемости
    if isinstance(res4[0], str) and res4[0] == '-':
        formatted_result = "−" + "".join(map(str, res4[1:]))
    else:
        formatted_result = "".join(map(str, res4))
    
    print(f"Результат: {formatted_result}")


def task5():
    """
    Выполняет задание 5 через консольный интерфейс.

    Process
    -------
    1. Запрашивает массив чисел через функцию input_arr().
    2. Запрашивает целевую сумму (целое число).
    3. Находит количество подмассивов с заданной суммой через модуль task_5.
    4. Сохраняет данные и результат в глобальные переменные:
       - data5 = (arr, target)
       - res5 = количество подмассивов
    5. Выводит результат.

    Global Variables
    ----------------
    data5 : tuple or None
        Кортеж (arr, target_sum) с исходными данными.
    res5 : int or None
        Количество подмассивов с заданной суммой.

    See Also
    --------
    input_arr : функция ввода массива
    execute_task_5_algorithm : алгоритм выполнения задания 5
    """
    global data5, res5
    print("\n--- Задание 5: Подмассивы с заданной суммой ---")
    
    arr = input_arr()
    target = int(input("Целевая сумма: "))
    
    data5 = (arr, target)
    res5 = execute_task_5_algorithm(arr, target)
    
    print(f"Количество подмассивов с суммой {target}: {res5}")


def main():
    """
    Главная функция программы, управляющая интерактивным циклом.

    Process
    -------
    1. Отображает меню через функцию menu().
    2. Обрабатывает выбор пользователя:
       - '1' → task1()
       - '4' → task4()
       - '5' → task5()
       - '0' → завершение программы
    3. Обрабатывает исключения:
       - ValueError при некорректном вводе
       - Другие исключения с выводом сообщения
    4. Цикл продолжается до выбора выхода.

    Raises
    ------
    SystemExit
        При выборе пункта '0' (выход).

    See Also
    --------
    menu : функция отображения меню
    task1, task4, task5 : функции выполнения заданий
    """
    while True:
        try:
            choice = menu()
            
            if choice == "1":
                task1()
            elif choice == "4":
                task4()
            elif choice == "5":
                task5()
            elif choice == "0":
                print("\nДо свидания!")
                sys.exit()
            else:
                print("\nОшибка: такого пункта меню нет!")
                
        except ValueError:
            print("\nОшибка: введено некорректное значение!")
        except Exception as e:
            print(f"\nНеожиданная ошибка: {e}")


if __name__ == "__main__":
    """Точка входа в программу."""
    main()